function renderHighlights(t){if(!t.length)return;const e=t.length,a=t[e-1];document.querySelector('#highlights [data-item="total_points"]').innerHTML=formatNumber(a.total),document.querySelector('#highlights [data-item="average_points"]').innerHTML=formatNumber(a.total/e,1),document.querySelector('#highlights [data-item="world_rank"]').innerHTML=formatNumber(a.rank),document.querySelector('#highlights [data-item="country_rank"]').innerHTML=formatNumber(a.country_rank),document.querySelector('#highlights [data-item="rank_change"]').innerHTML=formatDiff(a.rank_cng)}function renderCharts(t){if(!t.length)return;const e=(t=t.slice(-60)).map((t=>formatDate(t.date))),a=t.map((t=>Number(t.total))),o=t.map((t=>Number(t.daily))),r=t.map((t=>Number(t.rank))),n=t.map((t=>Number(t.country_rank)));Chart.defaults.font.family='"Archivo", sans-serif';const l={responsive:!0,plugins:{legend:{display:!1},tooltip:{enabled:!0,mode:"index",intersect:!1,padding:{top:10,left:10,right:24,bottom:8},displayColors:!1,titleMarginBottom:0,titleFont:{size:13},titleColor:"#222",bodyFont:{size:20},bodyColor:"#3b82f6",borderColor:"#3b82f6",backgroundColor:"#fff",borderWidth:1,callbacks:{title:t=>t[0].label,label:t=>formatNumber(t.parsed.y)}}},elements:{point:{radius:0},line:{borderWidth:3}},scales:{x:{grid:{color:"#f3f4f6",lineWidth:1},ticks:{color:"#888",maxRotation:0,minRotation:0}},y:{grid:{color:"#f3f4f6",lineWidth:1},ticks:{color:"#888",maxTicksLimit:6,callback:t=>formatCompact(t)}}}};new Chart(document.getElementById("totalPointsChart").getContext("2d"),{type:"line",data:{labels:e,datasets:[{label:"Total Points",data:a,borderColor:"#3b82f6",backgroundColor:"#3b82f611",fill:!0}]},options:l}),new Chart(document.getElementById("rankChart").getContext("2d"),{type:"line",data:{labels:e,datasets:[{label:"World Rank",data:r,borderColor:"#22c55e",backgroundColor:"#22c55e11",fill:!0,stepped:!0}]},options:{...l,scales:{...l.scales,y:{...l.scales.y,reverse:!0}}}}),new Chart(document.getElementById("dailyPointsChart").getContext("2d"),{type:"bar",data:{labels:e,datasets:[{label:"Daily Points",data:o,backgroundColor:"#fbbf24"}]},options:{...l,elements:{bar:{borderRadius:3}},scales:{...l.scales,x:{...l.scales.x,offset:!0},y:{...l.scales.y,min:0}}}}),new Chart(document.getElementById("countryRankChart").getContext("2d"),{type:"line",data:{labels:e,datasets:[{label:"Country Rank",data:n,borderColor:"#8b5cf6",backgroundColor:"#8b5cf611",fill:!0,stepped:!0}]},options:{...l,scales:{...l.scales,y:{...l.scales.y,reverse:!0}}}})}async function main(){const t=["date","total","daily","rank","rank_cng","team_rank","team_cng","country_rank","country_cng"],e=["project","total","share","today","daily","weekly","monthly","rank","rank_cng_day","rank_cng_week","rank_cng_month","team_rank","country_rank"],a=["rank","cpu","cores","os","total","daily","weekly","monthly","avg"],[o,r,n]=await Promise.all([fetchTable("db/daily",t,"total"),fetchTable("db/projects",e),fetchTable("db/hosts",a)]);renderHighlights(o),renderCharts(o),renderTable("dailyTable",t,o,["Date","Total","Daily","Rank","Δ Rank","Team Rank","Δ Team","Country Rank","Δ Country"],((t,e)=>"date"===t?`<td>${formatDate(e)}</td>`:t.endsWith("_cng")?`<td>${formatDiff(e)}</td>`:`<td>${formatNumber(e)}</td>`),0,!0),renderTable("projectsTable",e,r,["Project","Total","Share","Today","Daily","Weekly","Monthly","Rank","Δ Day","Δ Week","Δ Month","Team Rank","Country Rank"],((t,e)=>"project"===t?`<td>${e.replace(/^"|"$/g,"")}</td>`:t.startsWith("rank_cng_")?`<td>${formatDiff(e)}</td>`:`<td>${formatNumber(e)}</td>`)),renderTable("hostsTable",a,n,["Rank","CPU","Cores","OS","Total","Daily","Weekly","Monthly","Ø"],((t,e)=>"cpu"===t||"os"===t?`<td>${e}</td>`:`<td>${formatNumber(e)}</td>`))}window.addEventListener("DOMContentLoaded",main);