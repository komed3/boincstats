function renderHighlights(e){if(e.length)for(const[t,a]of Object.entries(e.at(-1))){const e=document.querySelector(`#highlights [data-item="${t}"]`);e&&(e.innerHTML=window[e.dataset.fnc??"formatNumber"](a,e.dataset.decimals??0))}}function renderCharts(e){if(!e.length)return;const t=e.slice(-60),a=t.map((e=>formatDate(e.date)));Object.values(chartConfig).forEach((e=>{const r=document.getElementById(e.id);r&&renderChart(r,{labels:a,data:t.map((t=>Number(t[e.col]))),label:e.label,color:e.color,type:e.isBar?"bar":"line",reverseY:e.reverseY,isBar:e.isBar,stepped:e.stepped,decimals:e.decimals,grouping:e.grouping})}))}function projectionSetup(e){if(!e.length)return;const t=e.at(-1),a=document.getElementById("projection-points"),r=document.getElementById("projection-date"),o=document.getElementById("projection-result");a&&r&&o&&(a.value=a.min=t.total,a.addEventListener("input",(e=>projectionLiveUpdate(e,t,a,r,o))),a.addEventListener("change",(e=>projectionLiveUpdate(e,t,a,r,o))),r.value=r.min=(new Date).toISOString().split("T")[0],r.addEventListener("input",(e=>projectionLiveUpdate(e,t,a,r,o))),r.addEventListener("change",(e=>projectionLiveUpdate(e,t,a,r,o))))}function projectionLiveUpdate(e,t,a,r,o){const n=new Date;let i=0,d=!1;"projection-points"===e.target.id?(i=Math.ceil((parseInt(a.value)-t.total)/t.rac_60),i>=0&&(n.setDate(n.getDate()+i),r.value=n.toISOString().split("T")[0],d=!0)):"projection-date"===e.target.id&&(i=Math.ceil((new Date(r.value)-n)/846e5),i>=0&&(a.value=parseInt(t.total)+parseInt(i*t.rac_60),d=!0)),i>1e5?o.innerHTML="Letâ€™s be realistic! Try for a lower score or a closer date.":d&&(o.innerHTML=`A score of <b>${formatNumber(a.value)}</b> will be reached in <b>${formatNumber(i)}</b> days around <b>${formatDate(r.value)}</b>`)}async function main(){const[e,t,a]=await Promise.all([fetchTable("db/daily",dailyCols,"total"),fetchTable("db/projects",projectsCols),fetchTable("db/hosts",hostsCols)]);renderHighlights(e),renderCharts(e),renderTable("dailyTable",dailyCols,e,dailyLabels,((e,t)=>"date"===e?`<td>${formatDate(t)}</td>`:e.endsWith("_cng")?`<td>${formatDiff(t)}</td>`:`<td>${formatNumber(t)}</td>`),0,!0),renderTable("projectsTable",projectsCols,t,projectsLabels,((e,t)=>"project"===e?`<td>${t.replace(/^"|"$/g,"")}</td>`:e.startsWith("rank_cng_")?`<td>${formatDiff(t)}</td>`:`<td>${formatNumber(t)}</td>`)),renderTable("hostsTable",hostsCols,a,hostsLabels,((e,t)=>"cpu"===e||"os"===e?`<td>${t}</td>`:`<td>${formatNumber(t)}</td>`)),projectionSetup(e)}window.addEventListener("DOMContentLoaded",main);