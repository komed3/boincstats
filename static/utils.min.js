function parseCSVLine(t){const e=[];let r=!1,i="";for(let a=0;a<t.length;++a){const n=t[a];if('"'===n)r=!r;else if(" "!==n||r)i+=n;else for(i.length&&(e.push(i),i="");" "===t[a+1];)++a}return i.length&&e.push(i),e}async function fetchTable(t,e,r){const i=await fetch(t);if(!i.ok)return[];return(await i.text()).split("\n").filter((t=>t.trim())).map(parseCSVLine).filter((t=>!r||"0"!==t[e.indexOf(r)]&&"0.0"!==t[e.indexOf(r)])).map((t=>{let r={};return e.forEach(((e,i)=>r[e]=t[i])),r}))}function formatNumber(t,e=0){return t&&!isNaN(t)?Number(t).toLocaleString("en-US",{minimumFractionDigits:e,maximumFractionDigits:e}):"–"}function formatCompact(t){return t=Number(t),isNaN(t)?"–":Math.abs(t)>=1e6?(t/1e6).toFixed(1).replace(/\.0$/,"")+"M":Math.abs(t)>=1e3?(t/1e3).toFixed(1).replace(/\.0$/,"")+"k":t.toString()}function formatDiff(t,e=0){if(isNaN(t)||null==t)return"–";const r=Number(t);return r>0?`<diff class="up">+${formatNumber(r,e)}</diff>`:r<0?`<diff class="down">${formatNumber(r,e)}</diff>`:'<diff class="equal">±0</diff>'}function formatDate(t){return t?new Date(t).toLocaleDateString("en-US",{year:"2-digit",month:"2-digit",day:"2-digit"}):"–"}function renderTable(t,e,r,i,a,n=0,o=!1){let l=n,s=o;!function n(o){const c=`<tr>${i.map(((t,e)=>`<th data-idx="${e}" class="sortable ${l===e?"active":""}">${t}${l===e?s?" ▲":" ▼":""}</th>`)).join("")}</tr>`,d=o.map((t=>`<tr>${e.map(((e,r)=>a(e,t[e]))).join("")}</tr>`)).join("");document.getElementById(t).innerHTML=`<thead>${c}</thead><tbody>${d}</tbody>`,document.querySelectorAll(`#${t} th.sortable`).forEach((t=>{t.onclick=()=>{const i=Number(t.dataset.idx);l===i?s=!s:(l=i,s=!0);const a=e[l];n([...r].sort(((t,e)=>{let r=t[a],i=e[a];return isNaN(r)||isNaN(i)||(r=Number(r),i=Number(i)),(r>i?1:r<i?-1:0)*(s?1:-1)})))}}))}(r),document.querySelectorAll(`#${t} th.sortable`)[l].click()}function renderChart(t,e,r,i){const{labels:a,data:n,label:o,color:l,type:s,reverseY:c,isBar:d}=e;let f=r?.start??a.length-60,u=r?.end??a.length;const m=a.slice(f,u),b=n.slice(f,u);return new Chart(t.getContext("2d"),{type:s||(d?"bar":"line"),data:{labels:m,datasets:[{label:o,data:b,borderColor:l,backgroundColor:l+"11",fill:!d,stepped:!!e.stepped,...d?{borderRadius:3}:{pointRadius:0,borderWidth:3}}]},options:{responsive:!0,plugins:{legend:{display:!1},tooltip:{enabled:!0,mode:"index",intersect:!1,displayColors:!1,bodyFont:{size:20,family:'"Archivo", sans-serif'},titleFont:{size:13,family:'"Archivo", sans-serif'},callbacks:{title:t=>t[0].label,label:t=>formatNumber(t.parsed.y)}}},elements:{point:{radius:0},line:{borderWidth:3}},scales:{x:{grid:{color:"#f3f4f6",lineWidth:1},ticks:{color:"#888",maxRotation:0,minRotation:0}},y:{grid:{color:"#f3f4f6",lineWidth:1},ticks:{color:"#888",maxTicksLimit:6,callback:t=>formatCompact(t)},reverse:!!c}},...i}})}