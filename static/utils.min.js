function parseCSVLine(t){const e=[];let o=!1,r="";for(let i=0;i<t.length;++i){const a=t[i];if('"'===a)o=!o;else if(" "!==a||o)r+=a;else for(r.length&&(e.push(r),r="");" "===t[i+1];)++i}return r.length&&e.push(r),e}async function fetchTable(t,e,o){const r=await fetch(t);if(!r.ok)return[];return(await r.text()).split("\n").filter((t=>t.trim())).map(parseCSVLine).filter((t=>!o||"0"!==t[e.indexOf(o)]&&"0.0"!==t[e.indexOf(o)])).map((t=>{let o={};return e.forEach(((e,r)=>o[e]=t[r])),o}))}function formatNumber(t,e=0){return t&&!isNaN(t)?Number(t).toLocaleString("en-US",{minimumFractionDigits:e,maximumFractionDigits:e}):"–"}function formatCompact(t){return t=Number(t),isNaN(t)?"–":Math.abs(t)>=1e6?(t/1e6).toFixed(1).replace(/\.0$/,"")+"M":Math.abs(t)>=1e3?(t/1e3).toFixed(1).replace(/\.0$/,"")+"k":t.toString()}function formatDiff(t,e=0){if(isNaN(t)||null==t)return"–";const o=Number(t);return o>0?`<diff class="up">+${formatNumber(o,e)}</diff>`:o<0?`<diff class="down">${formatNumber(o,e)}</diff>`:'<diff class="equal">±0</diff>'}function formatDate(t){return t?new Date(t).toLocaleDateString("en-US",{year:"2-digit",month:"2-digit",day:"2-digit"}):"–"}function renderTable(t,e,o,r,i,a=0,n=!1){let l=a,s=n;!function a(n){const c=`<tr>${r.map(((t,e)=>`<th data-idx="${e}" class="sortable ${l===e?"active":""}">${t}${l===e?s?" ▲":" ▼":""}</th>`)).join("")}</tr>`,f=n.map((t=>`<tr>${e.map(((e,o)=>i(e,t[e]))).join("")}</tr>`)).join("");document.getElementById(t).innerHTML=`<thead>${c}</thead><tbody>${f}</tbody>`,document.querySelectorAll(`#${t} th.sortable`).forEach((t=>{t.onclick=()=>{const r=Number(t.dataset.idx);l===r?s=!s:(l=r,s=!0);const i=e[l];a([...o].sort(((t,e)=>{let o=t[i],r=e[i];return isNaN(o)||isNaN(r)||(o=Number(o),r=Number(r)),(o>r?1:o<r?-1:0)*(s?1:-1)})))}}))}(o),document.querySelectorAll(`#${t} th.sortable`)[l].click()}function renderChart(t,e,o,r){const{labels:i,data:a,label:n,color:l,type:s,reverseY:c,isBar:f,grouping:d}=e;let u=o?.start??0,m=o?.end??i.length,h=i.slice(u,m),b=a.slice(u,m);const p=Math.max(10,Math.floor((t.offsetWidth||600)/(f?12:3)));if(h.length>p){const t=h.length/p;let e=[],o=[];for(let r=0;r<p;++r){const i=Math.floor(r*t),a=Math.floor((r+1)*t),n=h.slice(i,a),l=b.slice(i,a);n.length&&(e.push(n["first"===d?0:"last"===d?n.length-1:Math.floor(n.length/2)]),"sum"===d?o.push(l.reduce(((t,e)=>t+e),0)):"avg"===d?o.push(l.reduce(((t,e)=>t+e),0)/l.length):"first"===d?o.push(l[0]):o.push(l[l.length-1]))}h=e,b=o}return Chart.defaults.font.family='"Archivo", sans-serif',new Chart(t.getContext("2d"),{type:s||(f?"bar":"line"),data:{labels:h,datasets:[{label:n,data:b,borderColor:l,backgroundColor:l+(f?"ff":"11"),fill:!f,stepped:!!e.stepped,...f?{borderRadius:3}:{pointRadius:0,borderWidth:3}}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{enabled:!0,mode:"index",intersect:!1,padding:{top:10,left:10,right:24,bottom:8},displayColors:!1,titleMarginBottom:0,titleFont:{size:13,weight:400},titleColor:"#222",bodyFont:{size:20,weight:600},bodyColor:l,borderColor:l,backgroundColor:"#fff",borderWidth:1,callbacks:{title:t=>t[0].label,label:t=>formatNumber(t.parsed.y,e.decimals||0)}}},elements:{point:{radius:0},line:{borderWidth:3}},scales:{x:{grid:{color:"#f3f4f6",lineWidth:1},ticks:{color:"#888",maxRotation:0,minRotation:0,autoSkip:!0,maxTicksLimit:6}},y:{grid:{color:"#f3f4f6",lineWidth:1},ticks:{color:"#888",maxTicksLimit:6,callback:t=>formatCompact(t)},reverse:!!c}},...r}})}